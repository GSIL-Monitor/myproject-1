"use strict";$(function(){var a=false;$("#form").validate({rules:{companyId:{required:true},versionCode:{required:true},appName:{required:true},url:{required:true},appType:{required:true}},onkeyup:false,focusCleanup:true,success:"valid",submitHandler:function(l){var m=$("#appVersionId").val(),g=$("#companyId").val(),k=$("#versionCode").val(),f=$("#appName").val(),i=$("#url").val(),j=$("#description").val(),h=$("#appType").val();
if(a){return false;}a=true;$.ajax({type:"post",data:{appVersionId:m,companyId:g,versionCode:k,appName:f,url:i,description:j,appType:h},url:"/admin/editAppVersionSubmit",success:function(n){var n=JSON.parse(n);
if(n.code=="N00000"){layer.msg("保存成功!",{icon:1,time:1000});setTimeout(function(){$("#reset").trigger("click");},1200);}else{layer.msg(n.message,{icon:2,time:1000});
}a=false;},error:function(n,p,o){layer.msg("网络错误!",{icon:2,time:1000});a=false;}});}});$("#reset").on("click",function(){layer_close();return false;});
var b=$("#fileList"),c=$("#btn-star"),d="pending",e;var e=WebUploader.create({auto:true,swf:"/assets/lib/webuploader/0.1.5/Uploader.swf",server:"/admin/uploadAppVersionFile",duplicate:true,fileVar:"file",pick:{id:"#filePicker",name:"file",multiple:false},resize:false,accept:{title:"Files",extensions:"apk,ipa",mimeTypes:".apk,.ipa"}});
e.on("fileQueued",function(g){var h=$('<div id="'+g.id+'" class="item"><div class="pic-box"><img></div><div class="info">'+g.name+'</div><p class="state">等待上传...</p></div>'),f=h.find("img");
b.append(h);});e.on("uploadProgress",function(h,f){var i=$("#"+h.id),g=i.find(".progress-box .sr-only");if(!g.length){g=$('<div class="progress-box"><span class="progress-bar radius"><span class="sr-only" style="width:0%"></span></span></div>').appendTo(i).find(".sr-only");
}i.find(".state").text("上传中..");g.css("width",f*100+"%");});e.on("uploadSuccess",function(g,f){var h=JSON.parse(f._raw);if(h.code=="N00000"){$("#"+g.id).addClass("upload-state-success").find(".state").remove();
$("#url").val(h.data.fileName);}else{$("#"+g.id).addClass("upload-state-error").find(".state").text("上传出错");layer.msg(h.message,{icon:2,time:2*1000});}});
e.on("uploadError",function(f){$("#"+f.id).addClass("upload-state-error").find(".state").text("上传出错");});e.on("uploadComplete",function(f){$("#"+f.id).find(".progress-box").fadeOut();
});});