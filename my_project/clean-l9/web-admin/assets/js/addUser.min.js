"use strict";$(function(){var a=false;$(".skin-minimal input").iCheck({checkboxClass:"icheckbox-blue",radioClass:"iradio-blue",increaseArea:"20%"});$("#avatar").on("click",function(){$("input[type=file]").trigger("click");
});$.validator.addMethod("isPhone",function(k,j){var i=/(\+)([\d]*)(\s)([\d]*)/g;return this.optional(j)||((i.test(k)&&k.match(i).length==1)?true:false);
},"请正确填写手机号码");$("#form").validate({rules:{userName:{required:true},password:{required:true,minlength:6,maxlength:16},sex:{required:true},phone:{required:true,isPhone:true},email:{email:true}},onkeyup:false,focusCleanup:true,success:"valid",submitHandler:function(i){var q=$("#companyId").val(),o=$("#userName").val(),p=$("#password").val(),n=$("#avatar").val(),l=0,j=$(".iradio-blue"),m=$("#email").val(),k=$("#phone").val();
if(a){return false;}a=true;j.each(function(r){var s=$(this).hasClass("checked");l=s?r:l;});$.ajax({type:"post",data:{userName:o,companyId:q,password:window.md5(p),avatar:n,sex:l,email:m,phone:k},url:"/admin/addUserSubmit",success:function(r){var r=JSON.parse(r);
if(r.code=="N00000"){layer.msg("保存成功!",{icon:1,time:1000});window.parent.location.reload();setTimeout(function(){$("#reset").trigger("click");},1200);}else{layer.msg(r.message,{icon:2,time:1000});
}a=false;},error:function(r,t,s){layer.msg("网络错误!",{icon:2,time:1000});a=false;}});}});$("#reset").on("click",function(){layer_close();return false;});
var b=$("#fileList"),d=$("#btn-star"),e="pending",g,c=window.devicePixelRatio||1,h=110*c,f=110*c;var g=WebUploader.create({auto:true,swf:"/assets/lib/webuploader/0.1.5/Uploader.swf",server:"/admin/uploadAvatarFile",duplicate:true,fileVar:"file",pick:{id:"#filePicker",name:"file",label:"点击上传",multiple:false},resize:false,accept:{title:"Files",extensions:"gif,jpg,jpeg,bmp,png",mimeTypes:"image/*"}});
g.on("fileQueued",function(j){var k=$('<div id="'+j.id+'" class="item"><div class="pic-box"><img></div><p class="state">等待上传...</p></div>'),i=k.find("img");
b.append(k);g.makeThumb(j,function(l,m){if(l){i.replaceWith("<span>不能预览</span>");return;}i.attr("src",m);},h,f);});g.on("uploadProgress",function(k,i){var l=$("#"+k.id),j=l.find(".progress-box .sr-only");
if(!j.length){j=$('<div class="progress-box"><span class="progress-bar radius"><span class="sr-only" style="width:0%"></span></span></div>').appendTo(l).find(".sr-only");
}l.find(".state").text("上传中..");j.css("width",i*100+"%");});g.on("uploadSuccess",function(j,i){var k=JSON.parse(i._raw);if(k.code=="N00000"){$("#"+j.id).find(".state").text("上传成功");
$("#avatar").val(k.data.fileName);}else{$("#"+j.id).remove();layer.msg(k.message,{icon:2,time:2*1500});}});g.on("uploadError",function(i){$("#"+i.id).remove();
layer.msg("上传出错",{icon:2,time:2*1500});});g.on("uploadComplete",function(i){$("#"+i.id).remove();});});