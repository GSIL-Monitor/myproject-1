$(function(){function a(d,f){if(!d)return!1;var g=f||1,b=$("#sn").val(),c=$("#startDate").val(),h=$("#endDate").val(),l=$("#searchType").val(),e=$("#version").val(),m=$("#companyId").val();$.ajax({type:"POST",url:d,data:{startDate:c,endDate:h,sn:b,companyId:m,searchType:l,version:e,pageIndex:g,pageSize:CONFIG.pageSize},success:function(b){b=JSON.parse(b);var c=b.data;"N00000"==b.code&&void 0!=c?($("#listCount").text(c.totalCount),laypage({cont:$("#page"),skip:!0,groups:6,pages:c.totalPages,curr:g||1,jump:function(b,c){c||a(d,b.curr)}}),void 0!=c.data&&(b=c.data,$("#dataList").dataTable({autoWidth:!0,info:!1,paging:!1,ordering:!1,searching:!1,deferRender:!0,destroy:!0,data:b,columns:[{data:"machineId",render:function(b,c,k,a){return'\x3cinput type\x3d"checkbox" value\x3d"'+k.machineId+'" name\x3d"selDel"\x3e'}},{data:"sn"},{data:"machineName",render:function(b,c,k,a){return void 0!=k.machineName?k.machineName:""}},{data:"version",render:function(b,c,a,d){return void 0!=a.version?a.version:""}},{data:"hardware",render:function(b,c,a,d){return void 0!=a.hardware?a.hardware:""}},{data:"companyName"},{render:function(b,c,a,d){return void 0===a.sn?"":'\x3ca title\x3d"\u67e5\u770b" href\x3d"javascript:;" onclick\x3d"userDecShow (\'\u7528\u6237\u5217\u8868\u67e5\u770b\',\'/admin/getMachineUserList?pageSize\x3d100\x26sn\x3d'+a.sn+"')\"\x3e\u67e5\u770b\x3c/a\x3e"}},{data:"sn",render:function(b,c,a,d){return void 0===a.sn?"":'\x3ca title\x3d"\u67e5\u770b" href\x3d"javascript:;" onclick\x3d"DecInfoShow (\'\u673a\u5668\u72b6\u6001\u67e5\u770b\',\'/admin/getUserOrMachineIsOnline?type\x3d1\x26sn\x3d'+a.sn+"')\"\x3e\u67e5\u770b\x3c/a\x3e"}},{data:"lastUpdate",render:function(b,c,a,d){return a.lastUpdate.toString().replace(/T/g," ").replace(/\+[\d]{4}/,"")}},{data:"createTime",render:function(b,a,c,d){return c.createTime.toString().replace(/T/g," ").replace(/\+[\d]{4}/,"")}},{render:function(b,c,a,d){return'\x3ca title\x3d"\u7f16\u8f91" href\x3d"javascript:;" onclick\x3d"pageFullShow (\'\u673a\u5668\u7f16\u8f91\',\'/admin/editMachine?machineId\x3d'+a.machineId+'\')" class\x3d"ml-5" style\x3d"text-decoration:none"\x3e\x3ci class\x3d"Hui-iconfont"\x3e\x26#xe6df;\x3c/i\x3e\x3c/a\x3e \x3ca title\x3d"\u5220\u9664" href\x3d"javascript:;" onclick\x3d"delSelect(this,\'/admin/deleteMachineList?machineIdList\x3d'+a.machineId+'\')" class\x3d"ml-5" style\x3d"text-decoration:none"\x3e\x3ci class\x3d"Hui-iconfont"\x3e\x26#xe6e2;\x3c/i\x3e\x3c/a\x3e'}}],createdRow:function(b,a,c){$(b).addClass("text-c")}}))):layer.msg(b.message,{icon:1,time:1E3})},error:function(b,a,c){layer.msg("\u7f51\u7edc\u9519\u8bef!",{icon:1,time:1E3});console.error(b,a,c)}})}$("#search").on("click",function(){a("/admin/getMachinePageList",1);return!1}).trigger("click");delAllSelect("machineIdList","/admin/deleteMachineList")});function userDecShow(a,d,f){var g=d.split("\x26sn\x3d")[1];$.ajax({type:"post",url:d,success:function(b){b=JSON.parse(b);if("N00000"==b.code){var c=b.data,h;h='\x3carticle class\x3d"page-container" style\x3d"display:none;" id\x3d"addTb"\x3e'+('    \x3cform class\x3d"form form-horizontal" id\x3d"form" action\x3d"/admin/addUserMachine?sn\x3d'+g+'" method\x3d"post" data-href\x3d"'+d+'"\x3e');b='\x3cdiv class\x3d"cl pd-5 bg-1 bk-gray"\x3e \x3cspan class\x3d"l"\x3e \x3ca name\x3d"addUserMachine" href\x3d"javascript:;" class\x3d"btn btn-primary radius"\x3e\x3ci class\x3d"Hui-iconfont"\x3e\x26#xe600;\x3c/i\x3e \u6dfb\u52a0\u7528\u6237\x3c/a\x3e\x3c/span\x3e \x3c/div\x3e'+('\x3ctable class\x3d"table table-border table-bordered table-bg" data-href\x3d"'+d+'"\x3e');b+='    \x3cthead\x3e        \x3ctr class\x3d"text-c"\x3e            \x3cth\x3e\u7528\u6237\u540d\x3c/th\x3e            \x3cth\x3e\u7c7b\u578b\x3c/th\x3e            \x3cth\x3e\u5171\u4eab\u7528\u6237\u522b\u540d\x3c/th\x3e            \x3cth\x3e\u64cd\u4f5c\x3c/th\x3e        \x3c/tr\x3e    \x3c/thead\x3e    \x3ctbody\x3e';if(void 0==c)b+='        \x3ctr class\x3d"text-c"\x3e\x3ctd scope\x3d"col" colspan\x3d"4"\x3e\u6ca1\u6709\u6570\u636e\x3c/td\x3e\x3c/tr\x3e';else for(var l=c.length,e=0;e<l;e++)b+='        \x3ctr class\x3d"text-c"\x3e',b+="            \x3ctd\x3e"+c[e].userName+"\x3c/td\x3e",b+="            \x3ctd\x3e"+(1==c[e].userType?"\u4e3b\u4eba":"\u5171\u4eab")+"\x3c/td\x3e",b+="            \x3ctd\x3e"+(void 0!=c[e].noteName?c[e].noteName:"")+"\x3c/td\x3e",b+='            \x3ctd\x3e\x3ca name\x3d"deleteUserMachine" title\x3d"\u89e3\u9664\u7ed1\u5b9a" href\x3d"/admin/deleteUserMachine?\x26sn\x3d'+c[e].sn+"\x26userId\x3d"+c[e].userId+"\x26userType\x3d"+c[e].userType+"\x26userMachineId\x3d"+c[e].userMachineId+'" class\x3d"ml-5" style\x3d"text-decoration:none"\x3e\u89e3\u9664\u7ed1\u5b9a\x3c/a\x3e',2==c[e].userType&&(b+='\x3ca name\x3d"editUserUp" title\x3d"\u8bbe\u4e3a\u4e3b\u4eba" href\x3d"/admin/editUserUp?\x26sn\x3d'+c[e].sn+"\x26userId\x3d"+c[e].userId+"\x26userType\x3d"+c[e].userType+'" class\x3d"ml-5" style\x3d"text-decoration:none"\x3e\u8bbe\u4e3a\u4e3b\u4eba\x3c/a\x3e'),b+="            \x3c/td\x3e",b+="        \x3c/tr\x3e";b=b+"    \x3c/tbody\x3e\x3c/table\x3e"+(h+'        \x3cdiv class\x3d"row cl"\x3e            \x3clabel class\x3d"form-label col-xs-4 col-sm-2"\x3e\u7c7b\u578b\uff1a\x3c/label\x3e            \x3cdiv class\x3d"formControls col-xs-8 col-sm-9"\x3e                \x3cselect name\x3d"userType" id\x3d"userType"\x3e                    \x3coption value\x3d"1"\x3e\u4e3b\u4eba\x3c/option\x3e                    \x3coption value\x3d"2"\x3e\u5171\u4eab\x3c/option\x3e                \x3c/select\x3e            \x3c/div\x3e        \x3c/div\x3e        \x3cdiv class\x3d"row cl"\x3e            \x3clabel class\x3d"form-label col-xs-4 col-sm-2"\x3e\u7528\u6237\u540d\uff1a\x3c/label\x3e            \x3cdiv class\x3d"formControls col-xs-8 col-sm-9"\x3e                 \x3cinput type\x3d"text" class\x3d"input-text" value\x3d"" placeholder\x3d"\u7528\u6237\u540d/\u90ae\u7bb1/\u624b\u673a\uff08\u5982+86 13800888000\uff09" id\x3d"userName" name\x3d"userName"\x3e            \x3c/div\x3e        \x3c/div\x3e        \x3cdiv class\x3d"row cl"\x3e            \x3clabel class\x3d"form-label col-xs-4 col-sm-2"\x3e\u7528\u6237\u522b\u540d\uff1a\x3c/label\x3e            \x3cdiv class\x3d"formControls col-xs-8 col-sm-9"\x3e                \x3cinput type\x3d"text" class\x3d"input-text" value\x3d"" placeholder\x3d"\u7528\u6237\u522b\u540d" id\x3d"noteName" name\x3d"noteName"\x3e            \x3c/div\x3e        \x3c/div\x3e        \x3cdiv class\x3d"row cl"\x3e            \x3cdiv class\x3d"col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2"\x3e                \x3cbutton class\x3d"btn btn-primary radius" id\x3d"submit" type\x3d"submit"\x3e\x3ci class\x3d"Hui-iconfont"\x3e\x26#xe632;\x3c/i\x3e \u4fdd\u5b58\x3c/button\x3e                \x3cbutton id\x3d"reset" class\x3d"btn btn-default radius" type\x3d"button"\x3e\x26nbsp;\x26nbsp;\u53d6\u6d88\x26nbsp;\x26nbsp;\x3c/button\x3e            \x3c/div\x3e        \x3c/div\x3e    \x3c/form\x3e\x3c/article\x3e');void 0==f?layer.open({type:1,area:["800px","510px"],fix:!1,maxmin:!0,shade:.4,title:a,content:b}):f.html(b)}else layer.msg(c.message,{icon:2,time:1E3})},error:function(b,a,d){layer.msg("\u7f51\u7edc\u9519\u8bef!",{icon:2,time:1E3})}});return!1}function DecInfoShow(a,d,f){$.ajax({type:"get",url:d,success:function(a){a=JSON.parse(a);"N00000"==a.code&&(0===a.data?layer.msg("\u4e0d\u5728\u7ebf",{icon:2,time:3E3}):layer.msg("\u5728\u7ebf",{icon:1,time:3E3}))}})}var dis=!1;$(document).on("click",'a[name\x3d"deleteUserMachine"],a[name\x3d"editUserUp"]',function(){var a=this.href,d=$(this).parents("table"),f=d.parent(),g=d.attr("data-href");$.getJSON(a,function(a){var b=2;"N00000"==a.code&&(b=1,userDecShow("",g,f));layer.msg(a.message,{icon:b,time:1E3})});return!1}).on("click",'a[name\x3d"addUserMachine"]',function(){$("#addTb").show();return!1}).on("click","#reset",function(){$("#addTb").hide();return!1}).on("submit","#form",function(){var a=$(this),d={},f=a.attr("action"),g=a.attr("data-href"),b=$(".layui-layer-content"),a=$("#userName").val(),c=$("#noteName").val(),h=$("#userType").val();if(dis)return!1;if(!a)return layer.msg("\u7528\u6237\u540d\u5fc5\u586b",{icon:2,time:1E3}),!1;!a||isPhone(a)||isMail(a)||(d.userName=a);a&&isPhone(a)&&(d.phone=a);a&&isMail(a)&&(d.mail=a);d.noteName=c;d.userType=h;dis=!0;$.ajax({type:"post",data:d,url:f,success:function(a){a=JSON.parse(a);"N00000"==a.code?(layer.msg("\u6dfb\u52a0\u6210\u529f!",{icon:1,time:1E3}),$("#addTb").hide(),userDecShow("",g,b),setTimeout(function(){$("#search").trigger("click")},1200)):layer.msg(a.message,{icon:2,time:1E3});dis=!1},error:function(a,b,c){layer.msg("\u7f51\u7edc\u9519\u8bef!",{icon:2,time:1E3});dis=!1}});return!1});